<!doctype html>
<html lang="he" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>לוח חידון</title>

  <style>
    :root{
      --bg:#ffffff;
      --title:#0b0b0b;
      --cat:#cfe6bf;
      --card:#3f6fbf;
      --cardBorder:#2b4f8a;
      --level:#bfbfbf;
      --levelBorder:#8f8f8f;
      --text:#111;
    }
    body{ margin:0; font-family: system-ui, Arial; background:var(--bg); color:var(--text); }
    .wrap{ width: min(1120px, 96vw); margin: 22px auto; }

    /* כותרת עליונה */
    .topTitle{
      background: var(--title);
      color:#fff;
      border-radius:14px;
      padding:18px 14px;
      text-align:center;
      font-size:44px;
      font-weight:900;
      letter-spacing: .5px;
      margin-bottom: 18px;
    }

    /* כפתורים למעלה */
    .topActions{
      display:flex;
      gap:12px;
      justify-content:flex-start;
      margin-bottom: 14px;
    }
    .btn{
      background:#0f1730;
      color:#fff;
      border:1px solid #0f1730;
      padding:10px 14px;
      border-radius:12px;
      cursor:pointer;
      font-weight:700;
    }
    .btn:hover{ filter:brightness(1.05); }

    /* לוח */
    .board{
      display:grid;
      grid-template-columns: repeat(var(--cols), 1fr) 90px; /* קטגוריות + עמודת רמות */
      gap:18px 18px;
      align-items:start;
    }

    /* עיגולי קטגוריות */
    .cat{
      height:120px;
      border-radius:60px;
      background:var(--cat);
      border:2px solid #3b5a45;
      display:flex;
      flex-direction:column;
      align-items:center;
      justify-content:center;
      font-weight:900;
      user-select:none;
    }
    .cat .name{ font-size:26px; line-height:1.0; }
    .cat .num{ font-size:28px; margin-top:6px; }

    /* כרטיסי שאלות */
    .cell{
      height:78px;
      border-radius:14px;
      background:var(--card);
      border:2px solid var(--cardBorder);
      cursor:pointer;
    }
    .cell:hover{ filter:brightness(1.05); }
    .cell.used{
      background:#e6e6e6;
      border-color:#cfcfcf;
      cursor:not-allowed;
      filter:none;
    }

    /* עמודת רמות */
    .lvl{
      height:78px;
      border-radius:12px;
      background:var(--level);
      border:2px solid var(--levelBorder);
      display:flex;
      align-items:center;
      justify-content:center;
      font-weight:900;
      font-size:30px;
      user-select:none;
    }
    .lvlSpacer{ height:120px; }

    /* מודאל שאלה */
    .modalback{ position:fixed; inset:0; background: rgba(0,0,0,.55); display:none; align-items:center; justify-content:center; padding:18px; }
    .modal{
      width:min(900px, 96vw);
      background:#fff;
      border:2px solid #111;
      border-radius:18px;
      padding:18px;
    }
    .modal h2{ margin:0 0 10px; font-size:28px; }
    .meta{ opacity:.75; font-size:14px; margin-bottom:10px; }
    .items{ margin:12px 0; display:flex; flex-wrap:wrap; gap:10px; }
    .pill{ background:#f3f3f3; border:1px solid #cfcfcf; padding:10px 12px; border-radius:999px; font-weight:700; }
    .answer{ display:none; margin-top:12px; border-top:1px solid #ddd; padding-top:12px; }
    .modalTop{ display:flex; justify-content:space-between; gap:10px; align-items:flex-start; }

    @media (max-width: 900px){
      .topTitle{ font-size:34px; }
      .cat{ height:100px; border-radius:50px; }
      .cat .name{ font-size:20px; }
      .cat .num{ font-size:22px; }
      .cell, .lvl{ height:68px; }
      .board{ grid-template-columns: repeat(var(--cols), 1fr) 74px; gap:14px; }
    }
  </style>
</head>

<body>
  <div class="wrap">

    <div class="topActions">
      <button class="btn" id="fsBtn">מסך מלא</button>
      <button class="btn" id="resetBtn">איפוס משחק</button>
    </div>

    <div class="topTitle" id="gameTitle">נושא</div>

    <div class="board" id="board"></div>

  </div>

  <div class="modalback" id="modalBack">
    <div class="modal" role="dialog" aria-modal="true">
      <div class="modalTop">
        <div>
          <h2 id="qTitle"></h2>
          <div class="meta" id="qMeta"></div>
        </div>
        <button class="btn" id="closeBtn">סגור</button>
      </div>

      <div class="items" id="qItems"></div>

      <button class="btn" id="toggleAnswerBtn">הצג תשובה</button>

      <div class="answer" id="answerBox">
        <div style="font-weight:900; margin-bottom:8px;">התשובה (הסדר הנכון):</div>
        <div class="items" id="qAnswer"></div>
      </div>
    </div>
  </div>

<script>
  // התחלה: רמות קושי (אפשר לשנות בעתיד)
  const levels = [3,4,5,6];

  // כרגע שאלות דמו כדי שתראה את העיצוב.
  // בהמשך נעביר לקובץ questions.json כדי שתערוך רק שאלות.
  const questions = [
    {
      id:"demo-cat1-3",
      category:"קטגוריה 1",
      difficulty:3,
      prompt:"סדר את הערים מצפון לדרום:",
      items:["חיפה","תל אביב","ירושלים","באר שבע"],
      answer:["חיפה","תל אביב","ירושלים","באר שבע"]
    },
    {
      id:"demo-cat2-4",
      category:"קטגוריה 2",
      difficulty:4,
      prompt:"סדר את המפורסמים מהגבוה לנמוך:",
      items:["א","ב","ג","ד"],
      answer:["ב","ד","א","ג"]
    }
  ];

  // קטגוריות נגזרות מהשאלות (כך שהקטגוריות מתחלפות אוטומטית)
  const categories = [...new Set(questions.map(q => q.category))];

  // מצב "נלקח" נשמר בדפדפן
  const STORAGE_KEY = "quiz_used_ids_v2";
  let usedIds = new Set(JSON.parse(localStorage.getItem(STORAGE_KEY) || "[]"));
  let currentQ = null;

  const boardEl = document.getElementById("board");
  const modalBack = document.getElementById("modalBack");
  const qTitle = document.getElementById("qTitle");
  const qMeta = document.getElementById("qMeta");
  const qItems = document.getElementById("qItems");
  const qAnswer = document.getElementById("qAnswer");
  const answerBox = document.getElementById("answerBox");
  const toggleAnswerBtn = document.getElementById("toggleAnswerBtn");

  function saveUsed() {
    localStorage.setItem(STORAGE_KEY, JSON.stringify([...usedIds]));
  }

  function firstAvailable(category, difficulty) {
    return questions.find(q => q.category===category && q.difficulty===difficulty && !usedIds.has(q.id)) || null;
  }

  function renderBoard() {
    boardEl.innerHTML = "";
    boardEl.style.setProperty("--cols", categories.length);

    // שורת קטגוריות (עיגולים)
    // מספרים יורדים כמו בדוגמה (6..1) לפי כמות הקטגוריות
    for (let i = 0; i < categories.length; i++) {
      const c = categories[i];

      const cat = document.createElement("div");
      cat.className = "cat";

      const num = categories.length - i;
      cat.innerHTML = `<div class="name">${c}</div><div class="num">${num}</div>`;

      boardEl.appendChild(cat);
    }

    // רווח מול עמודת הרמות
    const spacer = document.createElement("div");
    spacer.className = "lvlSpacer";
    boardEl.appendChild(spacer);

    // שורות כרטיסים + רמה מימין
    for (const lvl of levels) {
      for (const c of categories) {
        const q = firstAvailable(c, lvl);
        const cell = document.createElement("div");
        cell.className = "cell";

        if (!q) {
          cell.classList.add("used");
        } else {
          cell.onclick = () => openQuestion(q);
        }

        boardEl.appendChild(cell);
      }

      const lvlBox = document.createElement("div");
      lvlBox.className = "lvl";
      lvlBox.textContent = lvl;
      boardEl.appendChild(lvlBox);
    }
  }

  function openQuestion(q) {
    currentQ = q;

    // ננעל מיד כשפותחים (כמו משחק לוח)
    usedIds.add(q.id);
    saveUsed();
    renderBoard();

    qTitle.textContent = q.prompt;
    qMeta.textContent = `${q.category} | קושי ${q.difficulty}`;
    qItems.innerHTML = q.items.map(x => `<div class="pill">${x}</div>`).join("");
    qAnswer.innerHTML = q.answer.map(x => `<div class="pill">${x}</div>`).join("");

    answerBox.style.display = "none";
    toggleAnswerBtn.textContent = "הצג תשובה";
    modalBack.style.display = "flex";
  }

  function closeModal() {
    modalBack.style.display = "none";
  }

  document.getElementById("closeBtn").onclick = closeModal;
  modalBack.addEventListener("click", (e) => { if (e.target === modalBack) closeModal(); });

  toggleAnswerBtn.onclick = () => {
    const shown = answerBox.style.display === "block";
    answerBox.style.display = shown ? "none" : "block";
    toggleAnswerBtn.textContent = shown ? "הצג תשובה" : "הסתר תשובה";
  };

  document.getElementById("resetBtn").onclick = () => {
    usedIds = new Set();
    saveUsed();
    renderBoard();
    closeModal();
  };

  document.getElementById("fsBtn").onclick = async () => {
    if (!document.fullscreenElement) await document.documentElement.requestFullscreen();
    else await document.exitFullscreen();
  };

  // מקשים נוחים על מקרן
  document.addEventListener("keydown", (e) => {
    if (e.key === "Escape") closeModal();
    if (e.key === "Enter" && modalBack.style.display === "flex") toggleAnswerBtn.click();
  });

  renderBoard();
</script>
</body>
</html>
